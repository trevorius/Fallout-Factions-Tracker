# ğŸ”„ GitHub Actions Workflows

This directory contains GitHub Actions workflows for automated testing and quality assurance.

## ğŸ§ª Workflows

### 1. `test.yml` - Main Test Workflow
**Triggers:** Push and Pull Requests to `main` and `develop` branches

**Features:**
- âœ… Runs on Node.js 18.x and 20.x
- ğŸ” ESLint code quality checks
- ğŸ—ï¸ Build verification
- ğŸ§ª Jest unit tests with coverage
- ğŸ“Š Codecov integration for coverage reports
- ğŸ“ˆ PR coverage comments (requires permissions)

**Note:** This workflow includes PR commenting which requires proper repository permissions. If you encounter permission errors, use the `test-simple.yml` workflow instead.

### 1a. `test-simple.yml` - Simplified Test Workflow (Fallback)
**Triggers:** Push and Pull Requests to `main` and `develop` branches

**Features:**
- âœ… Same as main workflow but without PR comments
- ğŸ“ Archives coverage reports as artifacts
- ğŸ›¡ï¸ No permission issues

**Steps:**
1. Checkout code
2. Setup Node.js with npm caching
3. Install dependencies
4. Run ESLint
5. Build project
6. Run Jest tests with coverage
7. Upload coverage to Codecov
8. Comment coverage on PRs

### 2. `test-matrix.yml` - Cross-Platform Tests
**Triggers:** Daily at 2 AM UTC, Manual dispatch

**Features:**
- ğŸ”„ Tests across Ubuntu, Windows, and macOS
- ğŸ”§ Tests Node.js versions 18.x, 20.x, and 21.x
- ğŸš€ Fail-fast disabled for comprehensive testing
- ğŸ“Š Test summaries for each matrix combination

## ğŸ› ï¸ Setup Requirements

### Environment Variables
The workflows require the following environment variables:

- `DATABASE_URL`: Set to a test database URL (mocked in CI)
- `NODE_ENV`: Set to `test` during test execution

### Secrets (Optional)
- `CODECOV_TOKEN`: For uploading coverage reports to Codecov
- `GITHUB_TOKEN`: Automatically provided by GitHub Actions

## ğŸ§ª Local Testing

To run the same tests locally:

```bash
# Install dependencies
npm ci

# Run linting
npm run lint

# Run tests with coverage
npm test -- --coverage --watchAll=false

# Build the project
npm run build
```

## ğŸ“Š Coverage Reports

Coverage reports are:
- Generated by Jest during test runs
- Uploaded to Codecov (if token is configured)
- Commented on Pull Requests automatically
- Stored in the `coverage/` directory

## ğŸ”§ Customization

### Adding New Test Commands
To add new test commands, update the workflow files and ensure corresponding npm scripts exist in `package.json`.

### Changing Node.js Versions
Update the `matrix.node-version` arrays in the workflow files to test different Node.js versions.

### Platform Support
The cross-platform workflow tests on:
- Ubuntu (Linux)
- Windows
- macOS

Remove platforms from the `matrix.os` array if not needed.

## ğŸš€ Performance Optimizations

- **Caching**: npm dependencies are cached using `actions/setup-node@v4`
- **Parallel Execution**: Matrix jobs run in parallel
- **Worker Limits**: `--maxWorkers=2` prevents resource exhaustion in CI
- **Watch Mode Disabled**: `--watchAll=false` for CI environments

## ğŸ”§ Troubleshooting

### Permission Errors (403 Forbidden)
If you see errors like "Resource not accessible by integration" or "403 Forbidden":

1. **Use the simplified workflow**: Switch to `test-simple.yml` which doesn't require PR comment permissions
2. **Check repository settings**: Ensure "Actions" have proper permissions in repository settings
3. **Fork restrictions**: Forked repositories may have limited permissions for security

### Common Issues

#### Coverage Reports Not Generated
- Ensure tests are running successfully
- Check that Jest is configured to generate coverage reports
- Verify `coverage/` directory is created

#### Tests Failing in CI but Passing Locally
- Check environment variables are set correctly
- Ensure all dependencies are installed with `npm ci`
- Verify Node.js version compatibility

#### Slow Test Execution
- Use `--maxWorkers=2` for CI environments
- Consider splitting large test suites
- Optimize test setup and teardown

### Workflow Selection Guide

- **Use `test.yml`**: If you have full repository permissions and want PR comments
- **Use `test-simple.yml`**: If you encounter permission issues or prefer simpler setup
- **Use `test-matrix.yml`**: For comprehensive cross-platform testing